{"version":3,"sources":["../src/client.ts","../src/login.ts","../src/logout.ts","../src/tokens.ts"],"names":[],"mappings":";;;AAEA,IAAM,WAAA,GAAc,gBAAA;AAEb,IAAM,eAAN,MAAmB;AAAA,EAQxB,YAAY,MAAA,EAA4B;AAFxC,IAAA,IAAA,CAAQ,UAAA,uBAAiB,GAAA,EAA2C;AAGlE,IAAA,IAAA,CAAK,MAAA,GAAS,MAAA;AACd,IAAA,IAAA,CAAK,EAAA,GAAK,OAAO,UAAA,EAAW;AAC5B,IAAA,IAAA,CAAK,QAAA,GAAW,CAAA,EAAG,MAAA,CAAO,OAAO,CAAA,GAAA,CAAA;AAEjC,IAAA,IAAA,CAAK,QAAA,GAAW,KAAK,YAAA,EAAa;AAElC,IAAA,MAAA,CAAO,gBAAA,CAAiB,SAAA,EAAW,CAAC,CAAA,KAAoB;AACtD,MAAA,IAAI,CAAA,CAAE,QAAQ,WAAA,EAAa;AACzB,QAAA,IAAA,CAAK,QAAA,GAAW,KAAK,YAAA,EAAa;AAAA,MACpC;AAAA,IACF,CAAC,CAAA;AAAA,EACH;AAAA,EAEA,UAAA,GAAiC;AAC/B,IAAA,OAAO,IAAA,CAAK,QAAA;AAAA,EACd;AAAA,EAEA,gBAAgB,EAAA,EAAuD;AACrE,IAAA,IAAA,CAAK,UAAA,CAAW,IAAI,EAAE,CAAA;AACtB,IAAA,OAAO,MAAM,IAAA,CAAK,UAAA,CAAW,MAAA,CAAO,EAAE,CAAA;AAAA,EACxC;AAAA,EAEA,MAAM,MAAA,GAAwB;AAC5B,IAAA,IAAI,CAAC,KAAK,QAAA,EAAU;AAEpB,IAAA,MAAM,IAAA,CAAK,OAAO,cAAA,EAAgB;AAAA,MAChC,MAAA,EAAQ,MAAA;AAAA,MACR,OAAA,EAAS,EAAE,cAAA,EAAgB,kBAAA,EAAmB;AAAA,MAC9C,IAAA,EAAM,KAAK,SAAA,CAAU,EAAE,cAAc,IAAA,CAAK,QAAA,CAAS,KAAA,CAAM,YAAA,EAAc;AAAA,KACxE,CAAA;AAED,IAAA,IAAA,CAAK,aAAA,EAAc;AAAA,EACrB;AAAA,EAEA,MAAM,MAAM,OAAA,EAAsC;AAChD,IAAA,MAAM,GAAA,GAAM,IAAI,GAAA,CAAI,CAAA,EAAG,KAAK,QAAQ,CAAA,MAAA,EAAS,OAAA,CAAQ,QAAQ,CAAA,CAAE,CAAA;AAC/D,IAAA,GAAA,CAAI,YAAA,CAAa,GAAA,CAAI,SAAA,EAAW,IAAA,CAAK,OAAO,MAAM,CAAA;AAClD,IAAA,GAAA,CAAI,YAAA,CAAa,GAAA,CAAI,cAAA,EAAgB,IAAA,CAAK,EAAE,CAAA;AAC5C,IAAA,GAAA,CAAI,YAAA,CAAa,GAAA,CAAI,cAAA,EAAgB,MAAA,CAAO,SAAS,MAAM,CAAA;AAE3D,IAAA,QAAQ,QAAQ,QAAA;AAAU,MACxB,KAAK,OAAA,EAAS;AACZ,QAAA,GAAA,CAAI,YAAA,CAAa,GAAA,CAAI,OAAA,EAAS,OAAA,CAAQ,KAAK,CAAA;AAC3C,QAAA;AAAA,MACF;AAAA,MACA,KAAK,QAAA,EAAU;AACb,QAAA;AAAA,MACF;AAAA,MACA,KAAK,QAAA,EAAU;AAEb,QAAA,MAAM,IAAI,MAAM,kCAAkC,CAAA;AAAA,MACpD;AAAA;AAGF,IAAA,MAAM,QAAQ,MAAA,CAAO,IAAA,CAAK,GAAA,CAAI,QAAA,IAAY,QAAQ,CAAA;AAElD,IAAA,MAAM,IAAI,OAAA,CAAc,CAAC,OAAA,KAAY;AACnC,MAAA,MAAM,QAAA,GAAW,YAAY,MAAM;AACjC,QAAA,IAAI,OAAO,MAAA,EAAQ;AACjB,UAAA,aAAA,CAAc,QAAQ,CAAA;AACtB,UAAA,OAAA,EAAQ;AAAA,QACV;AAAA,MACF,GAAG,GAAG,CAAA;AAAA,IACR,CAAC,CAAA;AAED,IAAA,MAAM,GAAA,GAAM,MAAM,IAAA,CAAK,MAAA,CAAO,CAAA,WAAA,CAAA,EAAe;AAAA,MAC3C,MAAA,EAAQ,MAAA;AAAA,MACR,OAAA,EAAS,EAAE,cAAA,EAAgB,kBAAA,EAAmB;AAAA,MAC9C,MAAM,IAAA,CAAK,SAAA,CAAU,EAAE,WAAA,EAAa,IAAA,CAAK,IAAI;AAAA,KAC9C,CAAA;AAED,IAAA,IAAI,CAAC,GAAA,CAAI,EAAA,EAAI,MAAM,IAAI,MAAM,cAAc,CAAA;AAE3C,IAAA,MAAM,OAAA,GAAW,MAAM,GAAA,CAAI,IAAA,EAAK;AAChC,IAAA,OAAA,CAAQ,GAAA,CAAI,EAAE,OAAA,EAAS,CAAA;AACvB,IAAA,IAAA,CAAK,cAAc,OAAO,CAAA;AAAA,EAC5B;AAAA,EAEQ,YAAA,GAAmC;AACzC,IAAA,MAAM,GAAA,GAAM,YAAA,CAAa,OAAA,CAAQ,WAAW,CAAA;AAC5C,IAAA,IAAI,CAAC,KAAK,OAAO,IAAA;AAEjB,IAAA,IAAI;AACF,MAAA,MAAM,OAAA,GAAU,IAAA,CAAK,KAAA,CAAM,GAAG,CAAA;AAE9B,MAAA,IAAI,CAAC,IAAA,CAAK,eAAA,CAAgB,OAAO,CAAA,EAAG;AAClC,QAAA,YAAA,CAAa,WAAW,WAAW,CAAA;AACnC,QAAA,OAAO,IAAA;AAAA,MACT;AAEA,MAAA,IAAI,OAAA,CAAQ,KAAA,CAAM,SAAA,GAAY,IAAA,CAAK,KAAI,EAAG;AACxC,QAAA,YAAA,CAAa,WAAW,WAAW,CAAA;AACnC,QAAA,OAAO,IAAA;AAAA,MACT;AAEA,MAAA,OAAO,OAAA;AAAA,IACT,CAAA,CAAA,MAAQ;AACN,MAAA,YAAA,CAAa,WAAW,WAAW,CAAA;AACnC,MAAA,OAAO,IAAA;AAAA,IACT;AAAA,EACF;AAAA,EAEQ,gBAAgB,KAAA,EAAsC;AAC5D,IAAA,IAAI,OAAO,KAAA,KAAU,QAAA,IAAY,KAAA,KAAU,MAAM,OAAO,KAAA;AAExD,IAAA,MAAM,CAAA,GAAI,KAAA;AAEV,IAAA,MAAM,IAAA,GAAO,EAAE,MAAM,CAAA;AACrB,IAAA,IAAI,OAAO,IAAA,KAAS,QAAA,IAAY,IAAA,KAAS,MAAM,OAAO,KAAA;AACtD,IAAA,MAAM,CAAA,GAAI,IAAA;AACV,IAAA,IAAI,OAAO,EAAE,IAAI,CAAA,KAAM,YAAY,CAAA,CAAE,IAAI,CAAA,KAAM,EAAA,EAAI,OAAO,KAAA;AAC1D,IAAA,IAAI,OAAO,EAAE,SAAS,CAAA,KAAM,YAAY,CAAA,CAAE,SAAS,CAAA,KAAM,EAAA,EAAI,OAAO,KAAA;AAEpE,IAAA,MAAM,KAAA,GAAQ,EAAE,OAAO,CAAA;AACvB,IAAA,IAAI,OAAO,KAAA,KAAU,QAAA,IAAY,KAAA,KAAU,MAAM,OAAO,KAAA;AACxD,IAAA,MAAM,CAAA,GAAI,KAAA;AACV,IAAA,IAAI,OAAO,EAAE,aAAa,CAAA,KAAM,YAAY,CAAA,CAAE,aAAa,CAAA,KAAM,EAAA,EAAI,OAAO,KAAA;AAC5E,IAAA,IAAI,OAAO,EAAE,cAAc,CAAA,KAAM,YAAY,CAAA,CAAE,cAAc,CAAA,KAAM,EAAA,EAAI,OAAO,KAAA;AAC9E,IAAA,IAAI,OAAO,CAAA,CAAE,WAAW,CAAA,KAAM,QAAA,IAAY,CAAC,MAAA,CAAO,QAAA,CAAS,CAAA,CAAE,WAAW,CAAC,CAAA,EAAG,OAAO,KAAA;AAEnF,IAAA,OAAO,IAAA;AAAA,EACT;AAAA,EAEQ,cAAc,OAAA,EAA4B;AAChD,IAAA,IAAA,CAAK,QAAA,GAAW,OAAA;AAChB,IAAA,YAAA,CAAa,OAAA,CAAQ,WAAA,EAAa,IAAA,CAAK,SAAA,CAAU,OAAO,CAAC,CAAA;AACzD,IAAA,IAAA,CAAK,OAAA,EAAQ;AAAA,EACf;AAAA,EAEQ,aAAA,GAAsB;AAC5B,IAAA,IAAA,CAAK,QAAA,GAAW,IAAA;AAChB,IAAA,YAAA,CAAa,WAAW,WAAW,CAAA;AACnC,IAAA,IAAA,CAAK,OAAA,EAAQ;AAAA,EACf;AAAA,EAEQ,OAAA,GAAgB;AACtB,IAAA,KAAA,MAAW,EAAA,IAAM,IAAA,CAAK,UAAA,EAAY,EAAA,CAAG,KAAK,QAAQ,CAAA;AAAA,EACpD;AAAA,EAEQ,MAAA,CAAO,IAAA,EAAc,IAAA,GAAoB,EAAC,EAAsB;AACtE,IAAA,OAAO,WAAW,KAAA,CAAM,CAAA,EAAG,KAAK,QAAQ,CAAA,EAAG,IAAI,CAAA,CAAA,EAAI;AAAA,MACjD,GAAG,IAAA;AAAA,MACH,OAAA,EAAS;AAAA,QACP,gBAAA,EAAkB,KAAK,MAAA,CAAO,MAAA;AAAA,QAC9B,GAAG,IAAA,CAAK;AAAA;AACV,KACD,CAAA;AAAA,EACH;AACF;;;AC9JA,eAAsB,KAAA,CACpB,SACA,YAAA,EACsB;AAEtB,EAAA,MAAM,IAAI,MAAM,iBAAiB,CAAA;AACnC;;;ACPA,eAAsB,OAAO,OAAA,EAAsC;AAEjE,EAAA,MAAM,IAAI,MAAM,iBAAiB,CAAA;AACnC;;;ACFA,eAAsB,YAAA,CACpB,SACA,MAAA,EACoB;AAEpB,EAAA,MAAM,IAAI,MAAM,iBAAiB,CAAA;AACnC;AAEO,SAAS,WAAW,OAAA,EAA2C;AAEpE,EAAA,OAAO,IAAA;AACT","file":"index.js","sourcesContent":["import type { AuthSession, LoginOptions, PollarClientConfig } from './types';\n\nconst STORAGE_KEY = 'pollar_session';\n\nexport class PollarClient {\n  readonly config: PollarClientConfig;\n  readonly id: string;\n  readonly basePath: string;\n  \n  private _session: AuthSession | null;\n  private _listeners = new Set<(session: AuthSession | null) => void>();\n  \n  constructor(config: PollarClientConfig) {\n    this.config = config;\n    this.id = crypto.randomUUID();\n    this.basePath = `${config.baseUrl}/v1`;\n    \n    this._session = this._readStorage();\n    \n    window.addEventListener('storage', (e: StorageEvent) => {\n      if (e.key === STORAGE_KEY) {\n        this._session = this._readStorage();\n      }\n    });\n  }\n  \n  getSession(): AuthSession | null {\n    return this._session;\n  }\n  \n  onSessionChange(cb: (session: AuthSession | null) => void): () => void {\n    this._listeners.add(cb);\n    return () => this._listeners.delete(cb);\n  }\n  \n  async logout(): Promise<void> {\n    if (!this._session) return;\n    \n    await this._fetch('/auth/logout', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ refreshToken: this._session.token.refreshToken }),\n    });\n    \n    this._clearSession();\n  }\n  \n  async login(options: LoginOptions): Promise<void> {\n    const url = new URL(`${this.basePath}/auth/${options.provider}`);\n    url.searchParams.set('api_key', this.config.apiKey);\n    url.searchParams.set('client_token', this.id);\n    url.searchParams.set('redirect_uri', window.location.origin);\n    \n    switch (options.provider) {\n      case 'email': {\n        url.searchParams.set('email', options.email);\n        break;\n      }\n      case 'google': {\n        break;\n      }\n      case 'github': {\n        // TODO: implement\n        throw new Error('GitHub login not implemented yet');\n      }\n    }\n    \n    const popup = window.open(url.toString(), '_blank');\n    \n    await new Promise<void>((resolve) => {\n      const interval = setInterval(() => {\n        if (popup?.closed) {\n          clearInterval(interval);\n          resolve();\n        }\n      }, 500);\n    });\n    \n    const res = await this._fetch(`/auth/login`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ clientToken: this.id }),\n    });\n    \n    if (!res.ok) throw new Error('Login failed');\n    \n    const session = (await res.json()) as AuthSession;\n    console.log({ session });\n    this._storeSession(session);\n  }\n  \n  private _readStorage(): AuthSession | null {\n    const raw = localStorage.getItem(STORAGE_KEY);\n    if (!raw) return null;\n    \n    try {\n      const session = JSON.parse(raw) as unknown;\n      \n      if (!this._isValidSession(session)) {\n        localStorage.removeItem(STORAGE_KEY);\n        return null;\n      }\n      \n      if (session.token.expiresAt < Date.now()) {\n        localStorage.removeItem(STORAGE_KEY);\n        return null;\n      }\n      \n      return session;\n    } catch {\n      localStorage.removeItem(STORAGE_KEY);\n      return null;\n    }\n  }\n  \n  private _isValidSession(value: unknown): value is AuthSession {\n    if (typeof value !== 'object' || value === null) return false;\n    \n    const s = value as Record<string, unknown>;\n    \n    const user = s['user'];\n    if (typeof user !== 'object' || user === null) return false;\n    const u = user as Record<string, unknown>;\n    if (typeof u['id'] !== 'string' || u['id'] === '') return false;\n    if (typeof u['address'] !== 'string' || u['address'] === '') return false;\n    \n    const token = s['token'];\n    if (typeof token !== 'object' || token === null) return false;\n    const t = token as Record<string, unknown>;\n    if (typeof t['accessToken'] !== 'string' || t['accessToken'] === '') return false;\n    if (typeof t['refreshToken'] !== 'string' || t['refreshToken'] === '') return false;\n    if (typeof t['expiresAt'] !== 'number' || !Number.isFinite(t['expiresAt'])) return false;\n    \n    return true;\n  }\n  \n  private _storeSession(session: AuthSession): void {\n    this._session = session;\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(session));\n    this._notify();\n  }\n  \n  private _clearSession(): void {\n    this._session = null;\n    localStorage.removeItem(STORAGE_KEY);\n    this._notify();\n  }\n  \n  private _notify(): void {\n    for (const cb of this._listeners) cb(this._session);\n  }\n  \n  private _fetch(path: string, init: RequestInit = {}): Promise<Response> {\n    return globalThis.fetch(`${this.basePath}${path}`, {\n      ...init,\n      headers: {\n        'x-polo-api-key': this.config.apiKey,\n        ...init.headers,\n      },\n    });\n  }\n}\n","import type { PollarClient } from './client';\nimport type { AuthCredentials, AuthSession } from './types';\n\nexport async function login(\n  _client: PollarClient,\n  _credentials: AuthCredentials,\n): Promise<AuthSession> {\n  // TODO: implement\n  throw new Error('Not implemented');\n}\n","import type { PollarClient } from './client';\n\nexport async function logout(_client: PollarClient): Promise<void> {\n  // TODO: implement\n  throw new Error('Not implemented');\n}\n","import type { PollarClient } from './client';\nimport type { AuthSession, AuthToken } from './types';\n\nexport async function refreshToken(\n  _client: PollarClient,\n  _token: string,\n): Promise<AuthToken> {\n  // TODO: implement\n  throw new Error('Not implemented');\n}\n\nexport function getSession(_client: PollarClient): AuthSession | null {\n  // TODO: implement\n  return null;\n}\n"]}